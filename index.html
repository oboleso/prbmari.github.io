<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://threejs.org/build/three.min.js"></script>
    <!-- <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script> -->
    <!-- <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script> -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <!-- <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v2.6.1/dist/aframe-extras.min.js"></script> -->
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v6.0.0/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-simple-sun-sky@^1.2.2/simple-sun-sky.js"></script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <img id="pasto" src="pano_pasto.jpg">
        <img id="apto" src="pano_casa_papas.jpg">
      </a-assets>
      <a-sky id='cielo' src="#pasto" 
        animation__fadein="startEvents: fadein; property: material.opacity; from: 0; to: 1; dur: 1000;"
        animation__fadeout="startEvents: fadeout; property: material.opacity; from: 1; to: 0; dur: 1000;"
      ></a-sky>

      <!-- <a-entity camera look-controls>
        <a-entity cursor="fuse: true; fuseTimeout: 500"
                  position="0 0 -1"
                  geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
                  material="color: black; shader: flat">
        </a-entity>
      </a-entity> -->
      <a-entity id="cam" camera look-controls position="0 0 0" 
        animation__fadein="startEvents: fadein; property: position; from: 0 0 0; to: 0 0 -450; dur: 500;"
        animation__fadeout="startEvents: fadeout; property: position; from: 0 0 -450; to: 0 0 0; dur: 0;">
        <a-entity
          animation__click="property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.01 0.01 0.01; to: 0.03 0.03 0.03"
          animation__fusing="property: scale; startEvents: fusing; easing: easeInCubic; dur: 1300; from: 0.03 0.03 0.03; to: 0.01 0.01 0.01"
          animation__mouseleave="property: scale; startEvents: mouseleave; easing: easeInCubic; dur: 300; to: 0.03 0.03 0.03"
          cursor="fuse: true;"
          material="color: #0f0; shader: flat"
          position="0 0 -3"
          geometry="primitive: ring">
        </a-entity>
      </a-entity> 
      
      <!-- <a-entity id="box" cursor-listener geometry="primitive: box" material="color: blue" position="-1 0.5 -3" rotation="0 45 0"></a-entity> -->
      <a-image src="#apto" position="-1 0 -4" cursor-listener data-imagen="#apto"></a-image>
    
      <!-- Basic triangle. -->
      <!-- <a-triangle color="#CCC" vertex-c="1 -1 0" position="-3 0 -3" ></a-triangle> -->
      
    </a-scene>

    <script>
      AFRAME.registerComponent('cursor-listener', {
        init: function () {
          //Para cambiar color cubo
          // var lastIndex = -1;
          // var COLORS = ['red', 'green', 'blue'];
          // this.el.addEventListener('click', function (evt) {
          //   lastIndex = (lastIndex + 1) % COLORS.length;
          //   this.setAttribute('material', 'color', COLORS[lastIndex]);
          //   console.log('I was clicked at: ', evt.detail.intersection.point);
          // });

          //Cambiar fotos --Animacion desvanecer cielo
        //   this.el.addEventListener('click', function (evt) {
        //     console.log(this.dataset.imagen);
        //     var imagen = this;
        //     var cielo = document.getElementById('cielo');
        //     cielo.emit('fadeout');

        //     if(this.dataset.imagen == "#apto")
        //     {              
        //       setTimeout(function () {
        //         cielo.setAttribute('src', '#apto');
        //         imagen.setAttribute('src', '#pasto');
        //         imagen.setAttribute('data-imagen', '#pasto');
        //       }, 1000);              
        //       setTimeout(function () {
        //         cielo.emit('fadein');                
        //       }, 1000);
              
        //     }
        //     else
        //     {              
        //       setTimeout(function () {
        //         cielo.setAttribute('src', '#pasto');
        //         imagen.setAttribute('src', '#apto');
        //         imagen.setAttribute('data-imagen', '#apto');
        //       }, 1000);              
        //       setTimeout(function () {
        //         cielo.emit('fadein');                
        //       }, 1000);
        //     }
        //     console.log('I was clicked at: ', evt.detail.intersection.point);
        //   });

        //Cambiar fotos -- Animación correr camara como google maps
        this.el.addEventListener('click', function (evt) {
            console.log(this.dataset.imagen);
            var imagen = this;
            var cielo = document.getElementById('cielo');
            var mycam = document.getElementById('cam');
            console.log("Rotación: ", mycam.getAttribute("rotation"));
            mycam.emit('fadein');

            if(this.dataset.imagen == "#apto")
            {              
              setTimeout(function () {
                cielo.setAttribute('src', '#apto');
                imagen.setAttribute('src', '#pasto');
                imagen.setAttribute('data-imagen', '#pasto');
                imagen.setAttribute('position', '-2.5 0 -4');
                mycam.emit('fadeout'); 
              }, 500);              
              // setTimeout(function () {
              //   mycam.emit('fadeout');                
              // }, 500);
              
            }
            else
            {              
              setTimeout(function () {
                cielo.setAttribute('src', '#pasto');
                imagen.setAttribute('src', '#apto');
                imagen.setAttribute('data-imagen', '#apto');
                imagen.setAttribute('position', '-1 0 -4');
                mycam.emit('fadeout'); 
              }, 500);              
              // setTimeout(function () {
              //   cielo.emit('fadeout');                
              // }, 500);
            }
            console.log('I was clicked at: ', evt.detail.intersection.point);
          });


         }
      });

      window.addEventListener("wheel", event => {
        const delta = Math.sign(event.wheelDelta);
        //getting the mouse wheel change (120 or -120 and normalizing it to 1 or -1)
        var mycam = document.getElementById('cam').getAttribute('camera');
        var finalZoom = document.getElementById('cam').getAttribute('camera').zoom + delta;
        //limiting the zoom so it doesnt zoom too much in or out
        if(finalZoom < 1)
          finalZoom = 1;
        if(finalZoom > 8)
          finalZoom = 8;  

        mycam.zoom = finalZoom;
        //setting the camera element
        document.getElementById('cam').setAttribute('camera', mycam);
      });
    </script>
  </body>
</html>